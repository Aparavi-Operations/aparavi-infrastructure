
- name: Get file information
  stat:
    path: "{{ aparavi_app_installer_path }}"
  register: installer

- name: Aparavi Platform | Download installer
  get_url:
    url: "{{ aparavi_app_url }}"
    dest: "{{ aparavi_app_installer_path }}"
    mode: '0775'
  when: not installer.stat.exists
  tags:
    - platform

- name: Aparavi Platform | Retrieving MySQL password
  debug:
    msg:
      - "Check your MySQL user password: {{ mysql_appuser_password }}"
  tags:
    - never
    - platform

- name: Aparavi Platform | Install platform
  ansible.builtin.shell: "{{ aparavi_app_installer_path }}" -- /APPTYPE={{ aparavi_app_type }} /RDBHOST={{redis_cache_address}} /LOCALURL={{ aparavi_platform_addr }} /DBTYPE={{ db_type }} /DBHOST={{ db_addr }} /DBPORT={{ db_port }} /DBUSER={{ db_user }} /DBPSWD={{ db_passwd }} /SILENT /NOSTART
  args:
    warn: no
  notify: Restart Aparavi Platform
  tags:
    - platform

- name: Aparavi Platform | Run the Platform
  ansible.builtin.shell: /opt/aparavi-data-ia/{{ aparavi_app_type }}/app/startapp
  tags:
    - platform

- name: Aparavi Platform | Wait until default config file created
  wait_for:
    path: /etc/opt/aparavi-data-ia/{{ aparavi_app_type }}/config/config.json
  tags:
    - platform

# - name: Aparavi Platform | Copy configuration file
#   template:
#     src:  config.json.j2
#     dest: /etc/opt/aparavi-data-ia/{{ aparavi_app_type }}/config/config.json
#   notify: Restart Aparavi Platform
#   tags:
#     - platform
